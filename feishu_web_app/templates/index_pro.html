<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>数据分析工具</title>
    <link rel="stylesheet" href="/public/app.css" />
    <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
    
    <!-- 引入飞书 JSSDK -->
    <script
      type="text/javascript"
      src="https://lf1-cdn-tos.bytegoofy.com/goofy/lark/op/h5-js-sdk-1.5.16.js"
    ></script>
    
    <!-- 引入 vConsole 用于移动端调试 -->
    <script src="https://unpkg.com/vconsole/dist/vconsole.min.js"></script>
    <script>
      var vConsole = new window.VConsole();
    </script>
    <script src="https://sf1-scmcdn-cn.feishucdn.com/obj/feishu-static/op/fe/devtools_frontend/remote-debug-0.0.1-alpha.6.js"></script>
</head>

<body>
    <!-- 顶部导航栏 -->
    <nav class="navbar">
        <div class="navbar-container">
            <div class="navbar-left">
                <div class="app-logo">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                        <rect width="32" height="32" rx="8" fill="#0089FF"/>
                        <path d="M16 8L20 12L16 16L12 12L16 8Z" fill="white"/>
                        <path d="M16 16L20 20L16 24L12 20L16 16Z" fill="white" opacity="0.7"/>
                    </svg>
                </div>
                <h1 class="app-title">数据分析工具</h1>
            </div>
            
            <div class="navbar-right" id="navbar-right">
                <!-- 登录前显示 -->
                <div id="login-button-container" style="display: none;">
                    <button class="btn-login" onclick="doLogin()">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M8 8a3 3 0 100-6 3 3 0 000 6zM8 9c-3.3 0-6 2.7-6 6h12c0-3.3-2.7-6-6-6z"/>
                        </svg>
                        飞书登录
                    </button>
                </div>
                
                <!-- 登录后显示 -->
                <div id="user-info-container" class="user-info-nav" style="display: none;">
                    <div class="user-stats">
                        <span class="stat-item" title="分析次数">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                <path d="M2 12h2V8H2v4zm4 0h2V4H6v8zm4 0h2V6h-2v6zm4 0h2V2h-2v10z"/>
                            </svg>
                            <span id="analysis-count">0</span>
                        </span>
                    </div>
                    
                    <div class="user-dropdown" onclick="toggleUserMenu()">
                        <img id="user-avatar-nav" src="" alt="头像" class="user-avatar-small" />
                        <span id="user-name-nav" class="user-name-text">加载中...</span>
                        <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor" class="dropdown-icon">
                            <path d="M6 8L2 4h8L6 8z"/>
                        </svg>
                    </div>
                    
                    <!-- 用户下拉菜单 -->
                    <div id="user-menu" class="user-menu" style="display: none;">
                        <div class="user-menu-header">
                            <img id="user-avatar-menu" src="" alt="头像" class="user-avatar-large" />
                            <div class="user-menu-info">
                                <div class="user-menu-name" id="user-name-menu">用户名</div>
                                <div class="user-menu-email" id="user-email-menu">邮箱</div>
                            </div>
                        </div>
                        <div class="user-menu-divider"></div>
                        <div class="user-menu-items">
                            <a href="#" class="user-menu-item" onclick="showHistory(); return false;">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                    <path d="M8 2a6 6 0 00-6 6h2a4 4 0 014-4V2zm0 12a6 6 0 006-6h-2a4 4 0 01-4 4v2z"/>
                                </svg>
                                分析历史
                            </a>
                            <a href="#" class="user-menu-item" onclick="showFiles(); return false;">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                    <path d="M4 2h5l2 2h3a1 1 0 011 1v8a1 1 0 01-1 1H4a1 1 0 01-1-1V3a1 1 0 011-1z"/>
                                </svg>
                                我的文件
                            </a>
                            <a href="#" class="user-menu-item" onclick="showSettings(); return false;">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                    <path d="M8 10a2 2 0 100-4 2 2 0 000 4zm6-2c0-.3 0-.6-.1-.9l1.3-1-.9-1.5-1.5.4c-.4-.3-.9-.6-1.4-.8l-.3-1.6h-1.8l-.3 1.6c-.5.2-1 .5-1.4.8l-1.5-.4-.9 1.5 1.3 1c-.1.3-.1.6-.1.9s0 .6.1.9l-1.3 1 .9 1.5 1.5-.4c.4.3.9.6 1.4.8l.3 1.6h1.8l.3-1.6c.5-.2 1-.5 1.4-.8l1.5.4.9-1.5-1.3-1c.1-.3.1-.6.1-.9z"/>
                                </svg>
                                设置
                            </a>
                        </div>
                        <div class="user-menu-divider"></div>
                        <a href="#" class="user-menu-item user-menu-logout" onclick="logout(); return false;">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                <path d="M6 2H3a1 1 0 00-1 1v10a1 1 0 001 1h3M11 5l3 3-3 3M14 8H6"/>
                            </svg>
                            退出登录
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- 主内容区 -->
    <div class="main-container">
        <!-- 加载状态 -->
        <div id="loading-screen" class="loading-screen">
            <div class="loading-content">
                <div class="loading-spinner-large"></div>
                <p class="loading-text">正在初始化...</p>
                <p class="loading-subtext">请稍候</p>
            </div>
        </div>

        <!-- 登录提示界面 -->
        <div id="login-prompt" class="login-prompt" style="display: none;">
            <div class="login-prompt-content">
                <div class="login-prompt-icon">
                    <svg width="80" height="80" viewBox="0 0 80 80" fill="none">
                        <circle cx="40" cy="40" r="38" stroke="#0089FF" stroke-width="4"/>
                        <path d="M40 20v20l15 10" stroke="#0089FF" stroke-width="4" stroke-linecap="round"/>
                    </svg>
                </div>
                <h2>欢迎使用数据分析工具</h2>
                <p>请使用飞书账号登录以继续</p>
                <button class="btn-login-large" onclick="doLogin()">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M10 10a4 4 0 100-8 4 4 0 000 8zM10 12c-4.4 0-8 3.6-8 8h16c0-4.4-3.6-8-8-8z"/>
                    </svg>
                    使用飞书登录
                </button>
            </div>
        </div>

        <!-- 应用主界面 -->
        <div id="app-content" class="app-content" style="display: none;">
            <div class="content-wrapper">
                <!-- 欢迎卡片 -->
                <div class="welcome-card">
                    <div class="welcome-text">
                        <h2>你好，<span id="welcome-user-name">用户</span>！</h2>
                        <p>今天准备分析什么数据？</p>
                    </div>
                    <div class="welcome-stats">
                        <div class="stat-card">
                            <div class="stat-number" id="stat-total">0</div>
                            <div class="stat-label">总分析次数</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="stat-success">0</div>
                            <div class="stat-label">成功次数</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="stat-files">0</div>
                            <div class="stat-label">上传文件</div>
                        </div>
                    </div>
                </div>

                <!-- 快速操作 -->
                <div class="quick-actions">
                    <h3>快速操作</h3>
                    <div class="action-grid">
                        <button class="action-card" onclick="uploadFile()">
                            <svg width="32" height="32" viewBox="0 0 32 32" fill="currentColor">
                                <path d="M16 4l8 8h-5v8h-6v-8H8l8-8zM8 24h16v4H8v-4z"/>
                            </svg>
                            <span>上传文件</span>
                        </button>
                        <button class="action-card" onclick="newAnalysis()">
                            <svg width="32" height="32" viewBox="0 0 32 32" fill="currentColor">
                                <path d="M4 24h6v-8H4v8zm8 0h6V8h-6v16zm8 0h6v-12h-6v12z"/>
                            </svg>
                            <span>新建分析</span>
                        </button>
                        <button class="action-card" onclick="showHistory()">
                            <svg width="32" height="32" viewBox="0 0 32 32" fill="currentColor">
                                <path d="M16 4a12 12 0 00-12 12h4a8 8 0 018-8V4zm0 24a12 12 0 0012-12h-4a8 8 0 01-8 8v4z"/>
                            </svg>
                            <span>历史记录</span>
                        </button>
                        <button class="action-card" onclick="showTemplates()">
                            <svg width="32" height="32" viewBox="0 0 32 32" fill="currentColor">
                                <path d="M4 4h10v10H4V4zm0 14h10v10H4V18zm14-14h10v10H18V4zm0 14h10v10H18V18z"/>
                            </svg>
                            <span>分析模板</span>
                        </button>
                    </div>
                </div>

                <!-- 最近分析 -->
                <div class="recent-section">
                    <div class="section-header">
                        <h3>最近分析</h3>
                        <a href="#" onclick="showHistory(); return false;">查看全部 →</a>
                    </div>
                    <div id="recent-list" class="recent-list">
                        <div class="empty-state">
                            <svg width="64" height="64" viewBox="0 0 64 64" fill="#ccc">
                                <path d="M32 8C18.7 8 8 18.7 8 32s10.7 24 24 24 24-10.7 24-24S45.3 8 32 8zm0 44c-11 0-20-9-20-20s9-20 20-20 20 9 20 20-9 20-20 20z"/>
                                <path d="M32 16v16l12 8"/>
                            </svg>
                            <p>还没有分析记录</p>
                            <p>开始你的第一次数据分析吧！</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/public/app.js"></script>
</body>
</html>



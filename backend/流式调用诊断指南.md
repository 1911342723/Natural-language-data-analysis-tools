# æµå¼è°ƒç”¨è¯Šæ–­æŒ‡å—

## ğŸ› é—®é¢˜ï¼šæµå¼è°ƒç”¨ä¸ç”Ÿæ•ˆ

å¦‚æœä½ çœ‹åˆ°åç«¯æ—¥å¿—æ˜¾ç¤ºï¼š
```
ğŸ¤– [AI æµå¼ç”Ÿæˆå¼€å§‹]
ğŸ¤– [AI å“åº”å®Œæˆ] æ€»é•¿åº¦: 913 å­—ç¬¦
```

ä¸­é—´æ²¡æœ‰ `ğŸ“¤ æ”¶åˆ° chunk #1`, `ğŸ“¤ æ”¶åˆ° chunk #2` ç­‰è¾“å‡ºï¼Œè¯´æ˜æµå¼è°ƒç”¨**æ²¡æœ‰ç”Ÿæ•ˆ**ã€‚

## ğŸ” è¯Šæ–­æ­¥éª¤

### 1. æ£€æŸ¥ API é…ç½®

ç¡®ä¿ `backend/.env` æ–‡ä»¶é…ç½®æ­£ç¡®ï¼š

```bash
# æŸ¥çœ‹ä½ çš„ .env æ–‡ä»¶
cat backend/.env

# æˆ–åœ¨ Windows ä¸Š
type backend\.env
```

**DeepSeek æ­£ç¡®é…ç½®**ï¼š
```bash
AI_PROVIDER=openai
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxx  # ä½ çš„ DeepSeek API Key
OPENAI_BASE_URL=https://api.deepseek.com/v1
OPENAI_MODEL=deepseek-chat
```

âš ï¸ **å¸¸è§é”™è¯¯**ï¼š
- âŒ `OPENAI_BASE_URL=https://api.deepseek.com` ï¼ˆç¼ºå°‘ `/v1`ï¼‰
- âŒ `OPENAI_MODEL=gpt-4o-mini` ï¼ˆåº”è¯¥æ˜¯ `deepseek-chat`ï¼‰
- âŒ `AI_PROVIDER=anthropic` ï¼ˆåº”è¯¥æ˜¯ `openai`ï¼‰

### 2. é‡å¯åç«¯å¹¶æŸ¥çœ‹å¯åŠ¨æ—¥å¿—

```bash
cd backend
python main.py
```

ä½ åº”è¯¥çœ‹åˆ°ï¼š
```
============================================================
ğŸš€ æ™ºèƒ½æ•°æ®åˆ†æå·¥å…·åç«¯å¯åŠ¨ä¸­...
============================================================
âœ… AI æä¾›å•†: openai
âœ… AI æ¨¡å‹: deepseek-chat
âœ… API Base URL: https://api.deepseek.com/v1
âœ… API Key: sk-xxxxxxxx...
âœ… ä¸Šä¼ ç›®å½•: ./uploads
âœ… æ•°æ®åº“: sqlite+aiosqlite:///./data/analysis.db
============================================================
```

**æ£€æŸ¥ç‚¹**ï¼š
- âœ… `AI æä¾›å•†` æ˜¯ `openai`ï¼ˆä¸æ˜¯ anthropicï¼‰
- âœ… `API Base URL` åŒ…å« `/v1`
- âœ… `API Key` æ˜¾ç¤ºä¸º `sk-xxxxxxxx...`

### 3. è¿è¡Œæµå¼è°ƒç”¨æµ‹è¯•è„šæœ¬

```bash
cd backend
python test_stream.py
```

**é¢„æœŸè¾“å‡º**ï¼š
```
============================================================
ğŸ§ª å¼€å§‹æµ‹è¯• AI æµå¼è°ƒç”¨
============================================================

ğŸ“ æµ‹è¯•æ¶ˆæ¯: è¯·ç”¨Pythonå†™ä¸€ä¸ªç®€å•çš„Hello Worldç¨‹åºï¼ŒåŒ…å«æ³¨é‡Š

ğŸŒŠ å¼€å§‹æµå¼æ¥æ”¶...

Chunk #1: '```'
Chunk #2: 'python'
Chunk #3: '\n'
Chunk #4: '#'
Chunk #5: ' '
Chunk #6: 'Hello'
Chunk #7: ' World'
...
Chunk #50: '```'

============================================================
âœ… æµå¼è°ƒç”¨å®Œæˆï¼
âœ… æ€»å…±æ”¶åˆ° 50 ä¸ª chunks
âœ… æ€»é•¿åº¦: 234 å­—ç¬¦
============================================================
```

### 4. åˆ†ææµ‹è¯•ç»“æœ

#### åœºæ™¯ Aï¼šæ”¶åˆ°å¤šä¸ª chunksï¼ˆæ­£å¸¸ï¼‰
```
âœ… æ€»å…±æ”¶åˆ° 50 ä¸ª chunks
```
**è¯´æ˜**ï¼šæµå¼è°ƒç”¨é…ç½®æ­£ç¡®ï¼

**è§£å†³æ–¹æ¡ˆ**ï¼š
- AI ç”Ÿæˆé€Ÿåº¦å¯èƒ½å¤ªå¿«ï¼Œå¯¼è‡´å‰ç«¯æ¥ä¸åŠæ˜¾ç¤º
- å·²ç»åœ¨ä»£ç ä¸­æ·»åŠ äº† `await asyncio.sleep(0.05)` æ¥å‡ç¼“é€Ÿåº¦
- å°è¯•æ›´é•¿çš„æç¤ºè¯ï¼Œè®© AI ç”Ÿæˆæ›´å¤šå†…å®¹

#### åœºæ™¯ Bï¼šåªæ”¶åˆ° 1 ä¸ª chunkï¼ˆå¼‚å¸¸ï¼‰
```
âš ï¸ åªæ”¶åˆ° 1 ä¸ª chunk
```
**è¯´æ˜**ï¼šæµå¼è°ƒç”¨æ²¡æœ‰ç”Ÿæ•ˆï¼ŒAI ä¸€æ¬¡æ€§è¿”å›å…¨éƒ¨å†…å®¹

**å¯èƒ½åŸå› **ï¼š
1. **API Base URL é…ç½®é”™è¯¯**
   - âŒ `https://api.deepseek.com` 
   - âœ… `https://api.deepseek.com/v1`

2. **ä½¿ç”¨äº†ä¸æ”¯æŒæµå¼çš„ API ç«¯ç‚¹**
   - ç¡®è®¤ DeepSeek API Key æ˜¯ Chat API çš„ Key

3. **ç½‘ç»œä»£ç†é—®é¢˜**
   - æŸäº›ä»£ç†å¯èƒ½ä¼šç¼“å†²æµå¼å“åº”

4. **OpenAI SDK ç‰ˆæœ¬é—®é¢˜**
   ```bash
   pip show openai  # æŸ¥çœ‹ç‰ˆæœ¬
   pip install --upgrade openai  # å‡çº§åˆ°æœ€æ–°ç‰ˆ
   ```

#### åœºæ™¯ Cï¼šæŠ¥é”™ï¼ˆé…ç½®é—®é¢˜ï¼‰
```
âŒ æµ‹è¯•å¤±è´¥: Authentication failed
```
**è¯´æ˜**ï¼šAPI Key æ— æ•ˆæˆ–é…ç½®é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ API Key æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥ API Key æ˜¯å¦è¿‡æœŸ
3. æ£€æŸ¥è´¦æˆ·ä½™é¢

### 5. æ£€æŸ¥ OpenAI SDK ç‰ˆæœ¬

DeepSeek éœ€è¦è¾ƒæ–°ç‰ˆæœ¬çš„ OpenAI SDKï¼š

```bash
pip show openai
```

**æ¨èç‰ˆæœ¬**ï¼š`openai >= 1.0.0`

å¦‚æœç‰ˆæœ¬è¿‡æ—§ï¼Œå‡çº§ï¼š
```bash
pip install --upgrade openai
```

### 6. æ‰‹åŠ¨æµ‹è¯• DeepSeek API

ä½¿ç”¨ curl æµ‹è¯•æµå¼è°ƒç”¨ï¼š

```bash
curl -X POST https://api.deepseek.com/v1/chat/completions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer sk-your-key-here" \
  -d '{
    "model": "deepseek-chat",
    "messages": [{"role": "user", "content": "Say hello"}],
    "stream": true
  }' \
  --no-buffer
```

**é¢„æœŸè¾“å‡º**ï¼šåº”è¯¥çœ‹åˆ°é€è¡Œè¿”å›çš„ `data:` æ¶ˆæ¯

```
data: {"id":"...","choices":[{"delta":{"content":"Hello"}}]}
data: {"id":"...","choices":[{"delta":{"content":"!"}}]}
data: {"id":"...","choices":[{"delta":{"content":" How"}}]}
...
data: [DONE]
```

å¦‚æœæ˜¯ä¸€æ¬¡æ€§è¿”å›æ‰€æœ‰å†…å®¹ï¼Œè¯´æ˜æµå¼è°ƒç”¨ç¡®å®æœ‰é—®é¢˜ã€‚

## ğŸ”§ å¸¸è§é—®é¢˜è§£å†³

### é—®é¢˜ 1ï¼šAPI Key é…ç½®äº†ä½†è¿˜æ˜¯æç¤ºæœªè®¾ç½®

**åŸå› **ï¼šç¯å¢ƒå˜é‡æ²¡æœ‰åŠ è½½

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ–¹æ³• 1: é‡å¯ç»ˆç«¯ï¼Œé‡æ–°è¿è¡Œ
cd backend
python main.py

# æ–¹æ³• 2: æ£€æŸ¥ .env æ–‡ä»¶æ˜¯å¦åœ¨æ­£ç¡®ä½ç½®
ls -la .env  # Linux/Mac
dir .env  # Windows

# æ–¹æ³• 3: æ‰‹åŠ¨è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆä¸´æ—¶ï¼‰
# Windows PowerShell
$env:OPENAI_API_KEY="sk-your-key"
$env:OPENAI_BASE_URL="https://api.deepseek.com/v1"
python main.py

# Linux/Mac
export OPENAI_API_KEY="sk-your-key"
export OPENAI_BASE_URL="https://api.deepseek.com/v1"
python main.py
```

### é—®é¢˜ 2ï¼šDeepSeek å“åº”é€Ÿåº¦å¤ªå¿«ï¼Œçœ‹ä¸åˆ°æµå¼æ•ˆæœ

**åŸå› **ï¼šDeepSeek ç”Ÿæˆé€Ÿåº¦éå¸¸å¿«ï¼ˆ100+ tokens/ç§’ï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. å·²åœ¨ä»£ç ä¸­æ·»åŠ  `await asyncio.sleep(0.05)` å‡ç¼“æ›´æ–°é€Ÿåº¦
2. ä½¿ç”¨æ›´é•¿çš„æç¤ºè¯ï¼Œè®© AI ç”Ÿæˆæ›´å¤šå†…å®¹
3. é™ä½ temperatureï¼ˆå·²è®¾ç½®ä¸º 0.1ï¼‰

**è¿™æ˜¯æ­£å¸¸ç°è±¡**ï¼šDeepSeek ç¡®å®æ¯” GPT-4 å¿«å¾—å¤šï¼

### é—®é¢˜ 3ï¼šå‰ç«¯æ²¡æœ‰æ˜¾ç¤ºæµå¼æ•ˆæœ

**åŸå› **ï¼šå‰ç«¯ SSE è¿æ¥æˆ–æ¸²æŸ“é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·
2. æŸ¥çœ‹ Network â†’ EventStream
3. ç¡®è®¤æ”¶åˆ°æŒç»­çš„ `data:` æ¶ˆæ¯

å¦‚æœçœ‹åˆ° `data:` æ¶ˆæ¯æµï¼Œè¯´æ˜åç«¯æ­£å¸¸ï¼Œé—®é¢˜åœ¨å‰ç«¯æ¸²æŸ“ã€‚

### é—®é¢˜ 4ï¼šç½‘ç»œä»£ç†å¹²æ‰°

**åŸå› **ï¼šæŸäº›ä»£ç†ä¼šç¼“å†²æµå¼å“åº”

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# ä¸´æ—¶ç¦ç”¨ä»£ç†
# Windows PowerShell
$env:HTTP_PROXY=""
$env:HTTPS_PROXY=""

# Linux/Mac
unset HTTP_PROXY
unset HTTPS_PROXY

# ç„¶åé‡æ–°è¿è¡Œ
python main.py
```

## âœ… æˆåŠŸæ ‡å¿—

å½“æµå¼è°ƒç”¨æ­£å¸¸å·¥ä½œæ—¶ï¼Œä½ ä¼šåœ¨åç«¯ç»ˆç«¯çœ‹åˆ°ï¼š

```
ğŸŒŠ å¼€å§‹æµå¼è°ƒç”¨: model=deepseek-chat, base_url=https://api.deepseek.com/v1
ğŸ“¤ æ”¶åˆ° chunk #1: '```'
ğŸ“¤ æ”¶åˆ° chunk #2: 'python'
ğŸ“¤ æ”¶åˆ° chunk #3: '\n'
ğŸ“¤ æ”¶åˆ° chunk #4: 'import'
ğŸ“¤ æ”¶åˆ° chunk #5: ' pandas'
...
ğŸ“¤ æ”¶åˆ° chunk #50: '```'
âœ… æµå¼è°ƒç”¨å®Œæˆï¼Œå…±æ”¶åˆ° 50 ä¸ª chunks
```

å‰ç«¯ä¼šçœ‹åˆ°ä»£ç åƒ"æ‰“å­—"ä¸€æ ·é€å­—å‡ºç° âœ¨

## ğŸ“ è¿˜æ˜¯ä¸è¡Œï¼Ÿ

å¦‚æœæŒ‰ç…§ä¸Šè¿°æ­¥éª¤è¿˜æ˜¯æ— æ³•è§£å†³ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. `python main.py` çš„å®Œæ•´å¯åŠ¨æ—¥å¿—
2. `python test_stream.py` çš„å®Œæ•´è¾“å‡º
3. `.env` æ–‡ä»¶å†…å®¹ï¼ˆéšè— API Key çš„æ•æ„Ÿéƒ¨åˆ†ï¼‰
4. `pip show openai` çš„è¾“å‡º
5. æ“ä½œç³»ç»Ÿå’Œ Python ç‰ˆæœ¬

è¿™æ ·å¯ä»¥æ›´å¿«å®šä½é—®é¢˜ï¼ğŸ”


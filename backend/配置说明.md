# é…ç½®è¯´æ˜

## ç¯å¢ƒå˜é‡é…ç½®

### ğŸ“ é…ç½®æ–‡ä»¶ä½ç½®

- **ç¯å¢ƒå˜é‡æ–‡ä»¶**: `backend/.env`
- **é…ç½®ç±»**: `backend/config.py`
- **ç¤ºä¾‹æ–‡ä»¶**: `backend/.env.example`

---

## ğŸ”‘ DeepSeek API é…ç½®ï¼ˆå½“å‰ä½¿ç”¨ï¼‰

ä½ å½“å‰ä½¿ç”¨çš„æ˜¯ **DeepSeek API**ï¼Œå®ƒå…¼å®¹ OpenAI æ¥å£æ ¼å¼ã€‚

### `.env` æ–‡ä»¶é…ç½®

```env
# AIæ¨¡å‹é…ç½®ï¼ˆä½¿ç”¨ DeepSeekï¼‰
OPENAI_API_KEY=sk-84fe44939a704f3d82d20e0bfad9c755
OPENAI_MODEL=deepseek-chat
OPENAI_BASE_URL=https://api.deepseek.com
AI_PROVIDER=openai
```

### é…ç½®è¯´æ˜

| é…ç½®é¡¹ | å€¼ | è¯´æ˜ |
|--------|-----|------|
| `OPENAI_API_KEY` | `sk-84fe...` | ä½ çš„ DeepSeek API å¯†é’¥ |
| `OPENAI_MODEL` | `deepseek-chat` | DeepSeek èŠå¤©æ¨¡å‹ |
| `OPENAI_BASE_URL` | `https://api.deepseek.com` | DeepSeek API åœ°å€ |
| `AI_PROVIDER` | `openai` | ä½¿ç”¨ OpenAI å…¼å®¹æ¥å£ |

---

## ğŸ”„ åˆ‡æ¢åˆ°å…¶ä»– AI æä¾›å•†

### 1. OpenAI (GPT)

```env
OPENAI_API_KEY=sk-your-openai-key-here
OPENAI_MODEL=gpt-4o-mini
OPENAI_BASE_URL=https://api.openai.com/v1
AI_PROVIDER=openai
```

**æ¨èæ¨¡å‹ï¼š**
- `gpt-4o-mini` - æœ€æ–°ã€ä¾¿å®œã€é€Ÿåº¦å¿«
- `gpt-4o` - æœ€å¼ºå¤§
- `gpt-4-turbo` - å¹³è¡¡æ€§èƒ½å’Œæˆæœ¬
- `gpt-3.5-turbo` - æœ€ä¾¿å®œ

### 2. Anthropic (Claude)

```env
ANTHROPIC_API_KEY=sk-ant-your-key-here
ANTHROPIC_MODEL=claude-3-5-sonnet-20241022
AI_PROVIDER=anthropic
```

**æ¨èæ¨¡å‹ï¼š**
- `claude-3-5-sonnet-20241022` - æœ€æ–°ã€æœ€å¼ºï¼ˆæ¨èï¼‰
- `claude-3-5-haiku-20241022` - é€Ÿåº¦å¿«ã€ä¾¿å®œ
- `claude-3-opus-20240229` - æœ€å¼ºå¤§ï¼ˆè´µï¼‰

### 3. å…¶ä»–å…¼å®¹ OpenAI çš„æœåŠ¡

DeepSeekã€æ™ºè°±AIã€ç™¾åº¦æ–‡å¿ƒç­‰å›½å†…æ¨¡å‹éƒ½æ”¯æŒ OpenAI æ ¼å¼ï¼š

```env
# æ™ºè°± AI (GLM)
OPENAI_API_KEY=your-zhipu-key
OPENAI_MODEL=glm-4
OPENAI_BASE_URL=https://open.bigmodel.cn/api/paas/v4
AI_PROVIDER=openai

# ç™¾åº¦æ–‡å¿ƒ
OPENAI_API_KEY=your-wenxin-key
OPENAI_MODEL=ernie-bot-turbo
OPENAI_BASE_URL=https://aip.baidubce.com/rpc/2.0/ai_custom/v1/wenxinworkshop
AI_PROVIDER=openai
```

---

## ğŸ”§ å®Œæ•´é…ç½®é¡¹è¯´æ˜

### API é…ç½®

```env
API_HOST=0.0.0.0          # ç›‘å¬åœ°å€ï¼ˆ0.0.0.0 è¡¨ç¤ºæ‰€æœ‰ç½‘å¡ï¼‰
API_PORT=8000             # ç«¯å£
DEBUG=True                # è°ƒè¯•æ¨¡å¼ï¼ˆç”Ÿäº§ç¯å¢ƒè®¾ä¸º Falseï¼‰
```

### æ•°æ®åº“é…ç½®

```env
DATABASE_URL=sqlite+aiosqlite:///./data/analysis.db
```

**å…¶ä»–æ•°æ®åº“ç¤ºä¾‹ï¼š**

```env
# PostgreSQL
DATABASE_URL=postgresql+asyncpg://user:password@localhost:5432/dbname

# MySQL
DATABASE_URL=mysql+aiomysql://user:password@localhost:3306/dbname
```

### æ–‡ä»¶ä¸Šä¼ é…ç½®

```env
UPLOAD_DIR=./uploads           # ä¸Šä¼ æ–‡ä»¶å­˜å‚¨ç›®å½•
MAX_FILE_SIZE=104857600        # æœ€å¤§æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼Œ100MBï¼‰
```

### Jupyter é…ç½®

```env
JUPYTER_TIMEOUT=300            # ä»£ç æ‰§è¡Œè¶…æ—¶ï¼ˆç§’ï¼‰
KERNEL_STARTUP_TIMEOUT=30      # Kernel å¯åŠ¨è¶…æ—¶ï¼ˆç§’ï¼‰
```

### å®‰å…¨é…ç½®

```env
ENABLE_CODE_SANDBOX=False      # æ˜¯å¦å¯ç”¨ Docker æ²™ç®±
DOCKER_IMAGE=python:3.11-slim  # Docker é•œåƒ
```

**âš ï¸ ç”Ÿäº§ç¯å¢ƒå»ºè®®ï¼š**
```env
ENABLE_CODE_SANDBOX=True       # å¯ç”¨æ²™ç®±éš”ç¦»
DEBUG=False                    # å…³é—­è°ƒè¯•æ¨¡å¼
```

---

## ğŸ“ é…ç½®ä¼˜å…ˆçº§

é…ç½®è¯»å–ä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š

1. **ç¯å¢ƒå˜é‡** - ç³»ç»Ÿç¯å¢ƒå˜é‡
2. **`.env` æ–‡ä»¶** - é¡¹ç›®æ ¹ç›®å½•çš„ `.env` æ–‡ä»¶
3. **é»˜è®¤å€¼** - `config.py` ä¸­å®šä¹‰çš„é»˜è®¤å€¼

**ç¤ºä¾‹ï¼š**

```python
# config.py ä¸­çš„é»˜è®¤å€¼
openai_model: str = Field(default="gpt-4o-mini", ...)

# .env æ–‡ä»¶ä¸­è¦†ç›–
OPENAI_MODEL=deepseek-chat  # âœ… å®é™…ä½¿ç”¨è¿™ä¸ªå€¼

# ç³»ç»Ÿç¯å¢ƒå˜é‡è¦†ç›–
export OPENAI_MODEL=gpt-4o  # âœ…âœ… ä¼˜å…ˆçº§æœ€é«˜
```

---

## ğŸ”’ å®‰å…¨æœ€ä½³å®è·µ

### 1. æ°¸è¿œä¸è¦æäº¤ `.env` æ–‡ä»¶

```bash
# .gitignore å·²é…ç½®
.env
```

### 2. ä½¿ç”¨ç¤ºä¾‹æ–‡ä»¶

```bash
# å¤åˆ¶ç¤ºä¾‹æ–‡ä»¶
cp .env.example .env

# ç¼–è¾‘ä½ çš„å®é™…é…ç½®
vim .env
```

### 3. å®šæœŸè½®æ¢å¯†é’¥

å»ºè®®æ¯ 3-6 ä¸ªæœˆæ›´æ–°ä¸€æ¬¡ API å¯†é’¥ã€‚

### 4. ä½¿ç”¨å¯†é’¥ç®¡ç†æœåŠ¡

ç”Ÿäº§ç¯å¢ƒæ¨èä½¿ç”¨ï¼š
- AWS Secrets Manager
- Azure Key Vault
- HashiCorp Vault

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æ£€æŸ¥é…ç½®

```bash
cd backend

# æŸ¥çœ‹ .env æ–‡ä»¶
cat .env

# éªŒè¯é…ç½®æ˜¯å¦æ­£ç¡®
python -c "from config import settings; print(f'API Key: {settings.openai_api_key[:10]}...')"
```

### 2. æµ‹è¯• AI è¿æ¥

```python
# test_ai.py
from core.ai_client import ai_client

messages = [
    {"role": "user", "content": "ä½ å¥½ï¼Œè¯·å›å¤'è¿æ¥æˆåŠŸ'"}
]

response = ai_client.chat(messages)
print(response)
```

è¿è¡Œæµ‹è¯•ï¼š

```bash
python test_ai.py
```

### 3. å¯åŠ¨æœåŠ¡

```bash
python main.py
```

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: API Key æ— æ•ˆ

**é”™è¯¯ä¿¡æ¯ï¼š**
```
AuthenticationError: Invalid API key
```

**è§£å†³æ–¹æ³•ï¼š**
1. æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„ API Key æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤æ²¡æœ‰å¤šä½™çš„ç©ºæ ¼æˆ–å¼•å·
3. éªŒè¯ API Key æ˜¯å¦è¿‡æœŸ

### Q2: æ— æ³•è¿æ¥åˆ° API

**é”™è¯¯ä¿¡æ¯ï¼š**
```
ConnectionError: Failed to connect to API
```

**è§£å†³æ–¹æ³•ï¼š**
1. æ£€æŸ¥ `OPENAI_BASE_URL` æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸
3. å°è¯•ä½¿ç”¨ä»£ç†ï¼š
   ```env
   HTTP_PROXY=http://127.0.0.1:7890
   HTTPS_PROXY=http://127.0.0.1:7890
   ```

### Q3: é…ç½®æœªç”Ÿæ•ˆ

**è§£å†³æ–¹æ³•ï¼š**
1. ç¡®è®¤ `.env` æ–‡ä»¶åœ¨æ­£ç¡®ä½ç½®ï¼ˆ`backend/` ç›®å½•ä¸‹ï¼‰
2. é‡å¯æœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆ
3. æ£€æŸ¥æ˜¯å¦æœ‰ç³»ç»Ÿç¯å¢ƒå˜é‡è¦†ç›–

---

## ğŸ“Š é…ç½®æ¨¡æ¿

### å¼€å‘ç¯å¢ƒ

```env
# .env (å¼€å‘ç¯å¢ƒ)
API_HOST=127.0.0.1
API_PORT=8000
DEBUG=True

OPENAI_API_KEY=sk-84fe44939a704f3d82d20e0bfad9c755
OPENAI_MODEL=deepseek-chat
OPENAI_BASE_URL=https://api.deepseek.com
AI_PROVIDER=openai

DATABASE_URL=sqlite+aiosqlite:///./data/analysis.db
UPLOAD_DIR=./uploads
MAX_FILE_SIZE=104857600

ENABLE_CODE_SANDBOX=False
```

### ç”Ÿäº§ç¯å¢ƒ

```env
# .env (ç”Ÿäº§ç¯å¢ƒ)
API_HOST=0.0.0.0
API_PORT=8000
DEBUG=False

OPENAI_API_KEY=your-production-key
OPENAI_MODEL=gpt-4o-mini
OPENAI_BASE_URL=https://api.openai.com/v1
AI_PROVIDER=openai

DATABASE_URL=postgresql+asyncpg://user:password@localhost:5432/analysis
UPLOAD_DIR=/data/uploads
MAX_FILE_SIZE=104857600

ENABLE_CODE_SANDBOX=True
DOCKER_IMAGE=python:3.11-slim
```

---

## ğŸ”— ç›¸å…³é“¾æ¥

- [DeepSeek å®˜ç½‘](https://www.deepseek.com/)
- [DeepSeek API æ–‡æ¡£](https://platform.deepseek.com/api-docs/)
- [OpenAI API æ–‡æ¡£](https://platform.openai.com/docs/api-reference)
- [Anthropic API æ–‡æ¡£](https://docs.anthropic.com/)

---

**æ›´æ–°æ—¥æœŸ**: 2025-10-30  
**å½“å‰é…ç½®**: DeepSeek API  
**çŠ¶æ€**: âœ… é…ç½®å®Œæˆ



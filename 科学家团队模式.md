# 🔬 科研级可视化功能使用指南

## 功能概述

本系统新增了**科研级可视化功能**，专门为科研人员和数据分析师设计，能够生成符合学术期刊标准的高质量图表和统计分析。

---

## ✨ 核心特性

### 1. 三种图表样式

#### 📄 出版级 (Publication)
- **适用场景**：学术论文投稿
- **特点**：
  - 300 DPI 高清输出
  - Arial/Helvetica 无衬线字体
  - 黑白打印友好配色
  - 符合 Nature/Science 等顶级期刊标准
- **图表尺寸**：3.5×2.5 英寸（单栏）

#### 📊 演示风格 (Presentation)
- **适用场景**：会议报告、PPT展示
- **特点**：
  - 150 DPI
  - 大字体（14pt）
  - 高对比度配色
  - 适合投影仪展示

#### 🌐 Web风格 (Web)
- **适用场景**：网页展示、在线报告
- **特点**：
  - 100 DPI
  - 支持交互式图表（Plotly）
  - 彩色配色方案
  - 适合屏幕浏览

---

### 2. 科研图表类型

#### 数据分布和对比
- **箱线图 (Box Plot)**：显示分位数、中位数、异常值
- **小提琴图 (Violin Plot)**：完整的概率密度分布
- **直方图 + 密度曲线**：数据分布形状

#### 组间对比
- **柱状图 (Bar Plot)**：类别间均值对比
- **点图 (Point Plot)**：均值和置信区间
- **分组箱线图**：多组分布对比

#### 相关性分析
- **散点图 (Scatter Plot)**：两变量关系
- **热力图 (Heatmap)**：多变量相关矩阵
- **散点矩阵图 (Pair Plot)**：多变量两两关系

#### 统计模型诊断
- **QQ图**：正态性检验
- **残差图**：回归诊断
- **ROC曲线**：分类模型评估

#### 医学/生物统计
- **生存曲线 (Kaplan-Meier)**
- **森林图 (Forest Plot)**：Meta分析
- **韦恩图 (Venn Diagram)**：集合关系

---

### 3. 自动统计分析

系统会根据数据类型和用户需求，自动选择合适的统计方法：

#### 组间比较
- **两组比较**：
  - 数据正态 → 独立样本t检验
  - 数据非正态 → Mann-Whitney U检验
- **多组比较**：
  - 数据正态 → 单因素ANOVA
  - 数据非正态 → Kruskal-Wallis H检验

#### 相关性分析
- Pearson相关（线性关系）
- Spearman相关（单调关系）

#### 效应量计算
- Cohen's d
- 置信区间
- p值标注

#### 结果报告（APA格式）
```
t(98) = 3.45, p = 0.001, d = 0.68
```

---

## 🚀 使用方法

### 步骤1：启用科研模式

在聊天输入框上方，找到**科研模式开关**：
```
[🔬] 科研模式  (ℹ️)
```

点击开关启用科研模式。

### 步骤2：选择图表样式

启用科研模式后，会出现**图表样式下拉菜单**：
- 出版级 📄
- 演示风格 📊
- Web风格 🌐

根据你的需求选择合适的样式。

### 步骤3：描述分析需求

在输入框中用自然语言描述你的需求，例如：

#### 示例1：基础统计
```
比较实验组和对照组的血压差异，画箱线图，并进行t检验
```

#### 示例2：相关性分析
```
分析身高和体重的相关性，画散点图，计算Pearson相关系数
```

#### 示例3：多组对比
```
按年龄段分组，比较收入水平，画小提琴图，进行方差分析
```

#### 示例4：正态性检验
```
检验数据是否符合正态分布，画QQ图和直方图
```

### 步骤4：查看结果

系统会实时显示：
1. **AI思考过程**：生成代码
2. **代码执行**：运行分析
3. **图表展示**：高质量可视化
4. **统计结果**：完整的统计报告
5. **AI洞察**：数据解读和建议

---

## 📊 输出示例

### 1. 出版级箱线图
```python
# 自动生成的代码示例
import matplotlib.pyplot as plt
import seaborn as sns
from scipy import stats

# 设置出版级样式
plt.rcParams['font.family'] = 'Arial'
plt.rcParams['font.size'] = 10
plt.rcParams['figure.dpi'] = 300

# 创建图表
fig, ax = plt.subplots(figsize=(3.5, 2.5))
bp = ax.boxplot([group_a, group_b], labels=['Control', 'Treatment'])

# 移除顶部和右侧边框
ax.spines['top'].set_visible(False)
ax.spines['right'].set_visible(False)

# 统计检验
t_stat, p_value = stats.ttest_ind(group_a, group_b)
print(f"t({len(group_a)+len(group_b)-2}) = {t_stat:.2f}, p = {p_value:.4f}")
```

### 2. 统计报告格式
```markdown
## 📊 统计分析结果

### 正态性检验
- Control组: W = 0.976, p = 0.156 (正态分布)
- Treatment组: W = 0.982, p = 0.234 (正态分布)

### 组间比较（独立样本t检验）
- t(98) = 3.45, **p = 0.001**, d = 0.68
- 结论：Treatment组显著高于Control组 (p < 0.01)

### 效应量
- Cohen's d = 0.68（中等效应量）
- 95% 置信区间：[0.25, 0.98]
```

---

## 🔧 技术实现

### 后端依赖
```txt
scipy>=1.11.0              # 科学计算和统计检验
statsmodels>=0.14.0         # 统计建模
matplotlib-venn>=0.11.9     # 韦恩图
pingouin>=0.5.3            # 统计分析
plotly>=5.18.0             # 交互式图表
lifelines>=0.27.0          # 生存分析
```

### 前端组件
- `ChartStyleSelector.jsx`：图表样式选择器
- `useAppStore.js`：状态管理（chartStyle, enableResearchMode）

### API接口
- 参数：`chart_style`（publication/presentation/web）
- 参数：`enable_research_mode`（boolean）

---

## 📝 最佳实践

### 1. 明确需求
❌ 不好："分析一下数据"
✅ 推荐："比较A组和B组的差异，进行t检验，画箱线图"

### 2. 选择合适的样式
- **投稿论文** → 出版级
- **会议报告** → 演示风格
- **网页报告** → Web风格

### 3. 检查数据质量
- 确保数据没有缺失值
- 检查异常值
- 验证数据类型正确

### 4. 理解统计结果
- p值 < 0.05：通常认为显著
- 效应量：小（0.2）、中（0.5）、大（0.8）
- 置信区间：不包含0表示显著

---

## 🎯 使用场景

### 场景1：医学研究
```
需求：比较新药和安慰剂的疗效
图表：箱线图 + 统计检验
样式：出版级（准备投稿）
```

### 场景2：商业分析
```
需求：分析不同地区的销售表现
图表：柱状图 + 方差分析
样式：演示风格（给老板汇报）
```

### 场景3：教育统计
```
需求：分析教学方法对成绩的影响
图表：小提琴图 + t检验
样式：Web风格（发布到学校网站）
```

---

## ⚠️ 注意事项

1. **科研模式仅适用于单文件模式**
2. **智能模式暂不支持科研图表**（使用经典模式）
3. **统计检验会自动选择**，但建议人工审查
4. **p值 < 0.001 时会标记为 p < 0.001**
5. **出版级图表适合打印**，Web风格适合屏幕

---

## 🐛 常见问题

### Q1: 为什么没有看到科研模式选项？
A: 请确保：
- 使用单文件上传模式（不是多文件）
- 已选择经典Agent模式（不是智能模式）

### Q2: 统计检验结果如何解读？
A: 
- **p < 0.05**：结果显著，拒绝原假设
- **p ≥ 0.05**：结果不显著，接受原假设
- **效应量**：即使显著，也要看效应量大小

### Q3: 如何导出高清图片？
A: 
- 选择"出版级"样式（300 DPI）
- 点击图表下方的"下载"按钮
- 图片会以PNG格式保存

### Q4: 能否自定义图表样式？
A: 
- 当前版本提供3种预设样式
- 后续版本会支持更多自定义选项

---

## 🔮 未来规划

- [ ] 支持更多图表类型（雷达图、桑基图）
- [ ] 支持自定义配色方案
- [ ] 支持导出为矢量图（SVG/PDF）
- [ ] 支持批量生成图表
- [ ] 支持图表模板保存

---

## 📧 反馈和建议

如果您在使用过程中遇到问题或有改进建议，欢迎通过以下方式联系：
- 提交 GitHub Issue
- 发送邮件至：your-email@example.com

---

**祝您分析愉快！🎉**

